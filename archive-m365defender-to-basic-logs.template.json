{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "solutionName": {
            "defaultValue": "m365defender-archive",
            "type": "String",
            "metadata": {
                "description": "This will be used as suffix for all resources."
            }
        },
        "storageAccountName": {
            "defaultValue": "storagem365darchive",
            "type": "String",
            "metadata": {
                "description": "Blob storage where Microsoft 365 Defender streaming API will (temporary) store all events."
            }
        }
    },
    "variables": {
        "workspaceName": "[concat('workspace-', parameters('solutionName'))]",
        "integrationAccountName": "[concat('integration-account-', parameters('solutionName'))]",
        "dataCollectionEndpointName": "[concat('dce-', parameters('solutionName'))]",
        "dataCollectionRulePrefix": "[concat('dcr-', parameters('solutionName'), '-')]",
        "uniqueDestinationString": "[substring(concat(uniqueString(string(subscription().subscriptionId)), uniqueString(parameters('solutionName')), uniqueString(variables('dataCollectionEndpointName'))), 0, 32)]",
        "logicAppName": "[concat('logicapp-', parameters('solutionName'))]",
        "logicAppConnectionName": "[concat('api-connection-', parameters('solutionName'), '-azureblob')]",
        "roleDefinitions": [
            "3913510d-42f4-4e42-8a64-420c390055eb", // Monitoring Metrics Publisher
            "ba92f5b4-2d11-453d-a403-e96b0029c9fe" // Storage Blob Data Contributor
        ]
    },
    "resources": [
        {
            "type": "microsoft.operationalinsights/workspaces",
            "apiVersion": "2021-12-01-preview",
            "name": "[variables('workspaceName')]",
            "location": "[resourceGroup().location]",
            "properties": {
                "sku": {
                    "name": "pergb2018"
                },
                "retentionInDays": 30,
                "features": {
                    "enableLogAccessUsingOnlyResourcePermissions": true
                },
                "workspaceCapping": {
                    "dailyQuotaGb": -1
                },
                "publicNetworkAccessForIngestion": "Enabled",
                "publicNetworkAccessForQuery": "Enabled"
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/alertevidence_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "alertevidence_archive_CL",
                    "columns": [
                        {
                            "name": "AccountDomain",
                            "type": "dynamic"
                        },
                        {
                            "name": "AccountName",
                            "type": "dynamic"
                        },
                        {
                            "name": "AccountObjectId",
                            "type": "dynamic"
                        },
                        {
                            "name": "AccountSid",
                            "type": "dynamic"
                        },
                        {
                            "name": "AccountUpn",
                            "type": "dynamic"
                        },
                        {
                            "name": "AdditionalFields",
                            "type": "string"
                        },
                        {
                            "name": "AlertId",
                            "type": "string"
                        },
                        {
                            "name": "Application",
                            "type": "dynamic"
                        },
                        {
                            "name": "ApplicationId",
                            "type": "dynamic"
                        },
                        {
                            "name": "DeviceId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceName",
                            "type": "string"
                        },
                        {
                            "name": "EmailSubject",
                            "type": "dynamic"
                        },
                        {
                            "name": "EntityType",
                            "type": "string"
                        },
                        {
                            "name": "EvidenceDirection",
                            "type": "dynamic"
                        },
                        {
                            "name": "EvidenceRole",
                            "type": "string"
                        },
                        {
                            "name": "FileName",
                            "type": "dynamic"
                        },
                        {
                            "name": "FileSize",
                            "type": "dynamic"
                        },
                        {
                            "name": "FolderPath",
                            "type": "dynamic"
                        },
                        {
                            "name": "LocalIP",
                            "type": "dynamic"
                        },
                        {
                            "name": "MachineGroup",
                            "type": "string"
                        },
                        {
                            "name": "NetworkMessageId",
                            "type": "dynamic"
                        },
                        {
                            "name": "OAuthApplicationId",
                            "type": "dynamic"
                        },
                        {
                            "name": "ProcessCommandLine",
                            "type": "dynamic"
                        },
                        {
                            "name": "RegistryKey",
                            "type": "dynamic"
                        },
                        {
                            "name": "RegistryValueData",
                            "type": "dynamic"
                        },
                        {
                            "name": "RegistryValueName",
                            "type": "dynamic"
                        },
                        {
                            "name": "RemoteIP",
                            "type": "dynamic"
                        },
                        {
                            "name": "RemoteUrl",
                            "type": "dynamic"
                        },
                        {
                            "name": "ServiceSource",
                            "type": "string"
                        },
                        {
                            "name": "SHA1",
                            "type": "dynamic"
                        },
                        {
                            "name": "SHA256",
                            "type": "dynamic"
                        },
                        {
                            "name": "ThreatFamily",
                            "type": "dynamic"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/alertinfo_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "alertinfo_archive_CL",
                    "columns": [
                        {
                            "name": "AlertId",
                            "type": "string"
                        },
                        {
                            "name": "AttackTechniques",
                            "type": "string"
                        },
                        {
                            "name": "Category",
                            "type": "string"
                        },
                        {
                            "name": "DetectionSource",
                            "type": "string"
                        },
                        {
                            "name": "MachineGroup",
                            "type": "string"
                        },
                        {
                            "name": "ServiceSource",
                            "type": "string"
                        },
                        {
                            "name": "Severity",
                            "type": "string"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "Title",
                            "type": "string"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/cloudappevents_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "cloudappevents_archive_CL",
                    "columns": [
                        {
                            "name": "AccountDisplayName",
                            "type": "string"
                        },
                        {
                            "name": "AccountId",
                            "type": "string"
                        },
                        {
                            "name": "AccountObjectId",
                            "type": "dynamic"
                        },
                        {
                            "name": "AccountType",
                            "type": "string"
                        },
                        {
                            "name": "ActionType",
                            "type": "string"
                        },
                        {
                            "name": "ActivityObjects",
                            "type": "dynamic"
                        },
                        {
                            "name": "ActivityType",
                            "type": "string"
                        },
                        {
                            "name": "AdditionalFields",
                            "type": "dynamic"
                        },
                        {
                            "name": "AppInstanceId",
                            "type": "int"
                        },
                        {
                            "name": "Application",
                            "type": "datetime"
                        },
                        {
                            "name": "ApplicationId",
                            "type": "int"
                        },
                        {
                            "name": "City",
                            "type": "dynamic"
                        },
                        {
                            "name": "CountryCode",
                            "type": "dynamic"
                        },
                        {
                            "name": "DeviceType",
                            "type": "string"
                        },
                        {
                            "name": "IPAddress",
                            "type": "dynamic"
                        },
                        {
                            "name": "IPCategory",
                            "type": "dynamic"
                        },
                        {
                            "name": "IPTags",
                            "type": "dynamic"
                        },
                        {
                            "name": "IsAdminOperation",
                            "type": "boolean"
                        },
                        {
                            "name": "IsAnonymousProxy",
                            "type": "dynamic"
                        },
                        {
                            "name": "IsExternalUser",
                            "type": "boolean"
                        },
                        {
                            "name": "IsImpersonated",
                            "type": "boolean"
                        },
                        {
                            "name": "ISP",
                            "type": "dynamic"
                        },
                        {
                            "name": "ObjectId",
                            "type": "dynamic"
                        },
                        {
                            "name": "ObjectName",
                            "type": "dynamic"
                        },
                        {
                            "name": "ObjectType",
                            "type": "dynamic"
                        },
                        {
                            "name": "OSPlatform",
                            "type": "string"
                        },
                        {
                            "name": "RawEventData",
                            "type": "dynamic"
                        },
                        {
                            "name": "ReportId",
                            "type": "string"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "UserAgent",
                            "type": "string"
                        },
                        {
                            "name": "UserAgentTags",
                            "type": "dynamic"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/deviceevents_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "deviceevents_archive_CL",
                    "columns": [
                        {
                            "name": "AccountDomain",
                            "type": "dynamic"
                        },
                        {
                            "name": "AccountName",
                            "type": "dynamic"
                        },
                        {
                            "name": "AccountSid",
                            "type": "dynamic"
                        },
                        {
                            "name": "ActionType",
                            "type": "string"
                        },
                        {
                            "name": "AdditionalFields",
                            "type": "string"
                        },
                        {
                            "name": "AppGuardContainerId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceName",
                            "type": "string"
                        },
                        {
                            "name": "FileName",
                            "type": "dynamic"
                        },
                        {
                            "name": "FileOriginIP",
                            "type": "dynamic"
                        },
                        {
                            "name": "FileOriginUrl",
                            "type": "dynamic"
                        },
                        {
                            "name": "FileSize",
                            "type": "int"
                        },
                        {
                            "name": "FolderPath",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessAccountDomain",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountObjectId",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessAccountSid",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessAccountUpn",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessCommandLine",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessCreationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessFileSize",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessFolderPath",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessId",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessLogonId",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessMD5",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessParentCreationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessParentFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessParentId",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessSHA1",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessSHA256",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoCompanyName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoFileDescription",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoInternalFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoOriginalFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoProductName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoProductVersion",
                            "type": "string"
                        },
                        {
                            "name": "LocalIP",
                            "type": "dynamic"
                        },
                        {
                            "name": "LocalPort",
                            "type": "dynamic"
                        },
                        {
                            "name": "LogonId",
                            "type": "dynamic"
                        },
                        {
                            "name": "MachineGroup",
                            "type": "string"
                        },
                        {
                            "name": "MD5",
                            "type": "dynamic"
                        },
                        {
                            "name": "ProcessCommandLine",
                            "type": "dynamic"
                        },
                        {
                            "name": "ProcessCreationTime",
                            "type": "dynamic"
                        },
                        {
                            "name": "ProcessId",
                            "type": "dynamic"
                        },
                        {
                            "name": "ProcessTokenElevation",
                            "type": "dynamic"
                        },
                        {
                            "name": "RegistryKey",
                            "type": "dynamic"
                        },
                        {
                            "name": "RegistryValueData",
                            "type": "dynamic"
                        },
                        {
                            "name": "RegistryValueName",
                            "type": "dynamic"
                        },
                        {
                            "name": "RemoteDeviceName",
                            "type": "dynamic"
                        },
                        {
                            "name": "RemoteIP",
                            "type": "dynamic"
                        },
                        {
                            "name": "RemotePort",
                            "type": "dynamic"
                        },
                        {
                            "name": "RemoteUrl",
                            "type": "dynamic"
                        },
                        {
                            "name": "ReportId",
                            "type": "int"
                        },
                        {
                            "name": "SHA1",
                            "type": "dynamic"
                        },
                        {
                            "name": "SHA256",
                            "type": "dynamic"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/devicefilecertificateinfo_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "devicefilecertificateinfo_archive_CL",
                    "columns": [
                        {
                            "name": "CertificateCountersignatureTime",
                            "type": "datetime"
                        },
                        {
                            "name": "CertificateCreationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "CertificateExpirationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "CertificateSerialNumber",
                            "type": "string"
                        },
                        {
                            "name": "CrlDistributionPointUrls",
                            "type": "string"
                        },
                        {
                            "name": "DeviceId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceName",
                            "type": "string"
                        },
                        {
                            "name": "IsRootSignerMicrosoft",
                            "type": "boolean"
                        },
                        {
                            "name": "IsSigned",
                            "type": "boolean"
                        },
                        {
                            "name": "Issuer",
                            "type": "datetime"
                        },
                        {
                            "name": "IssuerHash",
                            "type": "string"
                        },
                        {
                            "name": "IsTrusted",
                            "type": "boolean"
                        },
                        {
                            "name": "MachineGroup",
                            "type": "string"
                        },
                        {
                            "name": "ReportId",
                            "type": "int"
                        },
                        {
                            "name": "SHA1",
                            "type": "string"
                        },
                        {
                            "name": "SignatureType",
                            "type": "string"
                        },
                        {
                            "name": "Signer",
                            "type": "string"
                        },
                        {
                            "name": "SignerHash",
                            "type": "string"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/devicefileevents_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "devicefileevents_archive_CL",
                    "columns": [
                        {
                            "name": "ActionType",
                            "type": "string"
                        },
                        {
                            "name": "AdditionalFields",
                            "type": "dynamic"
                        },
                        {
                            "name": "AppGuardContainerId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceName",
                            "type": "string"
                        },
                        {
                            "name": "FileName",
                            "type": "string"
                        },
                        {
                            "name": "FileOriginIP",
                            "type": "dynamic"
                        },
                        {
                            "name": "FileOriginReferrerUrl",
                            "type": "dynamic"
                        },
                        {
                            "name": "FileOriginUrl",
                            "type": "dynamic"
                        },
                        {
                            "name": "FileSize",
                            "type": "int"
                        },
                        {
                            "name": "FolderPath",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountDomain",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountObjectId",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessAccountSid",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessAccountUpn",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessCommandLine",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessCreationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessFileSize",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessFolderPath",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessId",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessIntegrityLevel",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessMD5",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessParentCreationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessParentFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessParentId",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessSHA1",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessSHA256",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessTokenElevation",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoCompanyName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoFileDescription",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoInternalFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoOriginalFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoProductName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoProductVersion",
                            "type": "string"
                        },
                        {
                            "name": "IsAzureInfoProtectionApplied",
                            "type": "dynamic"
                        },
                        {
                            "name": "MachineGroup",
                            "type": "string"
                        },
                        {
                            "name": "MD5",
                            "type": "string"
                        },
                        {
                            "name": "PreviousFileName",
                            "type": "string"
                        },
                        {
                            "name": "PreviousFolderPath",
                            "type": "string"
                        },
                        {
                            "name": "ReportId",
                            "type": "int"
                        },
                        {
                            "name": "RequestAccountDomain",
                            "type": "string"
                        },
                        {
                            "name": "RequestAccountName",
                            "type": "string"
                        },
                        {
                            "name": "RequestAccountSid",
                            "type": "datetime"
                        },
                        {
                            "name": "RequestProtocol",
                            "type": "string"
                        },
                        {
                            "name": "RequestSourceIP",
                            "type": "dynamic"
                        },
                        {
                            "name": "RequestSourcePort",
                            "type": "dynamic"
                        },
                        {
                            "name": "SensitivityLabel",
                            "type": "dynamic"
                        },
                        {
                            "name": "SensitivitySubLabel",
                            "type": "dynamic"
                        },
                        {
                            "name": "SHA1",
                            "type": "string"
                        },
                        {
                            "name": "SHA256",
                            "type": "string"
                        },
                        {
                            "name": "ShareName",
                            "type": "dynamic"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/deviceimageloadevents_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "deviceimageloadevents_archive_CL",
                    "columns": [
                        {
                            "name": "ActionType",
                            "type": "string"
                        },
                        {
                            "name": "AppGuardContainerId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceName",
                            "type": "string"
                        },
                        {
                            "name": "FileName",
                            "type": "string"
                        },
                        {
                            "name": "FileSize",
                            "type": "int"
                        },
                        {
                            "name": "FolderPath",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountDomain",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountObjectId",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessAccountSid",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountUpn",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessCommandLine",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessCreationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessFileSize",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessFolderPath",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessId",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessIntegrityLevel",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessMD5",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessParentCreationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessParentFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessParentId",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessSHA1",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessSHA256",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessTokenElevation",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoCompanyName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoFileDescription",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoInternalFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoOriginalFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoProductName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoProductVersion",
                            "type": "string"
                        },
                        {
                            "name": "MachineGroup",
                            "type": "string"
                        },
                        {
                            "name": "MD5",
                            "type": "string"
                        },
                        {
                            "name": "ReportId",
                            "type": "int"
                        },
                        {
                            "name": "SHA1",
                            "type": "string"
                        },
                        {
                            "name": "SHA256",
                            "type": "string"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/deviceinfo_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "deviceinfo_archive_CL",
                    "columns": [
                        {
                            "name": "AadDeviceId",
                            "type": "string"
                        },
                        {
                            "name": "AdditionalFields",
                            "type": "string"
                        },
                        {
                            "name": "ClientVersion",
                            "type": "string"
                        },
                        {
                            "name": "DeviceId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceName",
                            "type": "string"
                        },
                        {
                            "name": "DeviceObjectId",
                            "type": "string"
                        },
                        {
                            "name": "IsAzureADJoined",
                            "type": "boolean"
                        },
                        {
                            "name": "JoinType",
                            "type": "string"
                        },
                        {
                            "name": "LoggedOnUsers",
                            "type": "string"
                        },
                        {
                            "name": "MachineGroup",
                            "type": "string"
                        },
                        {
                            "name": "OnboardingStatus",
                            "type": "string"
                        },
                        {
                            "name": "OSArchitecture",
                            "type": "dynamic"
                        },
                        {
                            "name": "OSBuild",
                            "type": "dynamic"
                        },
                        {
                            "name": "OSPlatform",
                            "type": "dynamic"
                        },
                        {
                            "name": "OSVersion",
                            "type": "dynamic"
                        },
                        {
                            "name": "PublicIP",
                            "type": "string"
                        },
                        {
                            "name": "RegistryDeviceTag",
                            "type": "dynamic"
                        },
                        {
                            "name": "ReportId",
                            "type": "int"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/devicelogonevents_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "devicelogonevents_archive_CL",
                    "columns": [
                        {
                            "name": "AccountDomain",
                            "type": "string"
                        },
                        {
                            "name": "AccountName",
                            "type": "datetime"
                        },
                        {
                            "name": "AccountSid",
                            "type": "dynamic"
                        },
                        {
                            "name": "ActionType",
                            "type": "string"
                        },
                        {
                            "name": "AdditionalFields",
                            "type": "string"
                        },
                        {
                            "name": "AppGuardContainerId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceName",
                            "type": "string"
                        },
                        {
                            "name": "FailureReason",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessAccountDomain",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountObjectId",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessAccountSid",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessAccountUpn",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessCommandLine",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessCreationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessFileSize",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessFolderPath",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessId",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessIntegrityLevel",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessMD5",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessParentCreationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessParentFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessParentId",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessSHA1",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessSHA256",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessTokenElevation",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoCompanyName",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoFileDescription",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoInternalFileName",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoOriginalFileName",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoProductName",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoProductVersion",
                            "type": "dynamic"
                        },
                        {
                            "name": "IsLocalAdmin",
                            "type": "dynamic"
                        },
                        {
                            "name": "LogonId",
                            "type": "dynamic"
                        },
                        {
                            "name": "LogonType",
                            "type": "string"
                        },
                        {
                            "name": "MachineGroup",
                            "type": "string"
                        },
                        {
                            "name": "Protocol",
                            "type": "dynamic"
                        },
                        {
                            "name": "RemoteDeviceName",
                            "type": "dynamic"
                        },
                        {
                            "name": "RemoteIP",
                            "type": "string"
                        },
                        {
                            "name": "RemoteIPType",
                            "type": "dynamic"
                        },
                        {
                            "name": "RemotePort",
                            "type": "dynamic"
                        },
                        {
                            "name": "ReportId",
                            "type": "int"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/devicenetworkevents_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "devicenetworkevents_archive_CL",
                    "columns": [
                        {
                            "name": "ActionType",
                            "type": "string"
                        },
                        {
                            "name": "AdditionalFields",
                            "type": "dynamic"
                        },
                        {
                            "name": "AppGuardContainerId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountDomain",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountObjectId",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessAccountSid",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessAccountUpn",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessCommandLine",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessCreationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessFileSize",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessFolderPath",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessId",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessIntegrityLevel",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessMD5",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessParentCreationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessParentFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessParentId",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessSHA1",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessSHA256",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessTokenElevation",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoCompanyName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoFileDescription",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoInternalFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoOriginalFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoProductName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoProductVersion",
                            "type": "string"
                        },
                        {
                            "name": "LocalIP",
                            "type": "string"
                        },
                        {
                            "name": "LocalIPType",
                            "type": "string"
                        },
                        {
                            "name": "LocalPort",
                            "type": "int"
                        },
                        {
                            "name": "MachineGroup",
                            "type": "string"
                        },
                        {
                            "name": "Protocol",
                            "type": "string"
                        },
                        {
                            "name": "RemoteIP",
                            "type": "string"
                        },
                        {
                            "name": "RemoteIPType",
                            "type": "string"
                        },
                        {
                            "name": "RemotePort",
                            "type": "int"
                        },
                        {
                            "name": "RemoteUrl",
                            "type": "string"
                        },
                        {
                            "name": "ReportId",
                            "type": "int"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/devicenetworkinfo_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "devicenetworkinfo_archive_CL",
                    "columns": [
                        {
                            "name": "ConnectedNetworks",
                            "type": "string"
                        },
                        {
                            "name": "DefaultGateways",
                            "type": "string"
                        },
                        {
                            "name": "DeviceId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceName",
                            "type": "string"
                        },
                        {
                            "name": "DnsAddresses",
                            "type": "string"
                        },
                        {
                            "name": "IPAddresses",
                            "type": "string"
                        },
                        {
                            "name": "IPv4Dhcp",
                            "type": "string"
                        },
                        {
                            "name": "IPv6Dhcp",
                            "type": "string"
                        },
                        {
                            "name": "MacAddress",
                            "type": "string"
                        },
                        {
                            "name": "MachineGroup",
                            "type": "string"
                        },
                        {
                            "name": "NetworkAdapterName",
                            "type": "string"
                        },
                        {
                            "name": "NetworkAdapterStatus",
                            "type": "string"
                        },
                        {
                            "name": "NetworkAdapterType",
                            "type": "string"
                        },
                        {
                            "name": "ReportId",
                            "type": "int"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "TunnelType",
                            "type": "string"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/deviceprocessevents_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "deviceprocessevents_archive_CL",
                    "columns": [
                        {
                            "name": "AccountDomain",
                            "type": "string"
                        },
                        {
                            "name": "AccountName",
                            "type": "string"
                        },
                        {
                            "name": "AccountObjectId",
                            "type": "dynamic"
                        },
                        {
                            "name": "AccountSid",
                            "type": "datetime"
                        },
                        {
                            "name": "AccountUpn",
                            "type": "dynamic"
                        },
                        {
                            "name": "ActionType",
                            "type": "string"
                        },
                        {
                            "name": "AdditionalFields",
                            "type": "dynamic"
                        },
                        {
                            "name": "AppGuardContainerId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceName",
                            "type": "string"
                        },
                        {
                            "name": "FileName",
                            "type": "string"
                        },
                        {
                            "name": "FileSize",
                            "type": "int"
                        },
                        {
                            "name": "FolderPath",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountDomain",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountObjectId",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessAccountSid",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessAccountUpn",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessCommandLine",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessCreationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessFileSize",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessFolderPath",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessId",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessIntegrityLevel",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessLogonId",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessMD5",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessParentCreationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessParentFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessParentId",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessSHA1",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessSHA256",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessSignatureStatus",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessSignerType",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessTokenElevation",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoCompanyName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoFileDescription",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoInternalFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoOriginalFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoProductName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoProductVersion",
                            "type": "string"
                        },
                        {
                            "name": "LogonId",
                            "type": "int"
                        },
                        {
                            "name": "MachineGroup",
                            "type": "string"
                        },
                        {
                            "name": "MD5",
                            "type": "string"
                        },
                        {
                            "name": "ProcessCommandLine",
                            "type": "string"
                        },
                        {
                            "name": "ProcessCreationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "ProcessId",
                            "type": "int"
                        },
                        {
                            "name": "ProcessIntegrityLevel",
                            "type": "string"
                        },
                        {
                            "name": "ProcessTokenElevation",
                            "type": "string"
                        },
                        {
                            "name": "ProcessVersionInfoCompanyName",
                            "type": "string"
                        },
                        {
                            "name": "ProcessVersionInfoFileDescription",
                            "type": "string"
                        },
                        {
                            "name": "ProcessVersionInfoInternalFileName",
                            "type": "string"
                        },
                        {
                            "name": "ProcessVersionInfoOriginalFileName",
                            "type": "string"
                        },
                        {
                            "name": "ProcessVersionInfoProductName",
                            "type": "string"
                        },
                        {
                            "name": "ProcessVersionInfoProductVersion",
                            "type": "string"
                        },
                        {
                            "name": "ReportId",
                            "type": "int"
                        },
                        {
                            "name": "SHA1",
                            "type": "string"
                        },
                        {
                            "name": "SHA256",
                            "type": "string"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/deviceregistryevents_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "deviceregistryevents_archive_CL",
                    "columns": [
                        {
                            "name": "ActionType",
                            "type": "string"
                        },
                        {
                            "name": "AppGuardContainerId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceId",
                            "type": "string"
                        },
                        {
                            "name": "DeviceName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountDomain",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessAccountObjectId",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessAccountSid",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessAccountUpn",
                            "type": "dynamic"
                        },
                        {
                            "name": "InitiatingProcessCommandLine",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessCreationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessFileSize",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessFolderPath",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessId",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessIntegrityLevel",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessMD5",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessParentCreationTime",
                            "type": "datetime"
                        },
                        {
                            "name": "InitiatingProcessParentFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessParentId",
                            "type": "int"
                        },
                        {
                            "name": "InitiatingProcessSHA1",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessSHA256",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessTokenElevation",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoCompanyName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoFileDescription",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoInternalFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoOriginalFileName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoProductName",
                            "type": "string"
                        },
                        {
                            "name": "InitiatingProcessVersionInfoProductVersion",
                            "type": "string"
                        },
                        {
                            "name": "MachineGroup",
                            "type": "string"
                        },
                        {
                            "name": "PreviousRegistryKey",
                            "type": "string"
                        },
                        {
                            "name": "PreviousRegistryValueData",
                            "type": "dynamic"
                        },
                        {
                            "name": "PreviousRegistryValueName",
                            "type": "dynamic"
                        },
                        {
                            "name": "RegistryKey",
                            "type": "string"
                        },
                        {
                            "name": "RegistryValueData",
                            "type": "dynamic"
                        },
                        {
                            "name": "RegistryValueName",
                            "type": "dynamic"
                        },
                        {
                            "name": "RegistryValueType",
                            "type": "string"
                        },
                        {
                            "name": "ReportId",
                            "type": "int"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/emailattachmentinfo_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "emailattachmentinfo_archive_CL",
                    "columns": [
                        {
                            "name": "DetectionMethods",
                            "type": "dynamic"
                        },
                        {
                            "name": "FileName",
                            "type": "string"
                        },
                        {
                            "name": "FileSize",
                            "type": "int"
                        },
                        {
                            "name": "FileType",
                            "type": "string"
                        },
                        {
                            "name": "NetworkMessageId",
                            "type": "string"
                        },
                        {
                            "name": "RecipientEmailAddress",
                            "type": "string"
                        },
                        {
                            "name": "RecipientObjectId",
                            "type": "dynamic"
                        },
                        {
                            "name": "ReportId",
                            "type": "string"
                        },
                        {
                            "name": "SenderDisplayName",
                            "type": "dynamic"
                        },
                        {
                            "name": "SenderFromAddress",
                            "type": "string"
                        },
                        {
                            "name": "SenderObjectId",
                            "type": "dynamic"
                        },
                        {
                            "name": "SHA256",
                            "type": "string"
                        },
                        {
                            "name": "ThreatNames",
                            "type": "dynamic"
                        },
                        {
                            "name": "ThreatTypes",
                            "type": "dynamic"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/emailevents_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "emailevents_archive_CL",
                    "columns": [
                        {
                            "name": "AdditionalFields",
                            "type": "dynamic"
                        },
                        {
                            "name": "AttachmentCount",
                            "type": "int"
                        },
                        {
                            "name": "AuthenticationDetails",
                            "type": "string"
                        },
                        {
                            "name": "ConfidenceLevel",
                            "type": "dynamic"
                        },
                        {
                            "name": "Connectors",
                            "type": "dynamic"
                        },
                        {
                            "name": "DeliveryAction",
                            "type": "string"
                        },
                        {
                            "name": "DeliveryLocation",
                            "type": "string"
                        },
                        {
                            "name": "DetectionMethods",
                            "type": "dynamic"
                        },
                        {
                            "name": "EmailAction",
                            "type": "dynamic"
                        },
                        {
                            "name": "EmailActionPolicy",
                            "type": "dynamic"
                        },
                        {
                            "name": "EmailActionPolicyGuid",
                            "type": "dynamic"
                        },
                        {
                            "name": "EmailClusterId",
                            "type": "long"
                        },
                        {
                            "name": "EmailDirection",
                            "type": "string"
                        },
                        {
                            "name": "EmailLanguage",
                            "type": "string"
                        },
                        {
                            "name": "InternetMessageId",
                            "type": "string"
                        },
                        {
                            "name": "NetworkMessageId",
                            "type": "string"
                        },
                        {
                            "name": "OrgLevelAction",
                            "type": "dynamic"
                        },
                        {
                            "name": "OrgLevelPolicy",
                            "type": "dynamic"
                        },
                        {
                            "name": "RecipientEmailAddress",
                            "type": "string"
                        },
                        {
                            "name": "RecipientObjectId",
                            "type": "string"
                        },
                        {
                            "name": "ReportId",
                            "type": "string"
                        },
                        {
                            "name": "SenderDisplayName",
                            "type": "string"
                        },
                        {
                            "name": "SenderFromAddress",
                            "type": "string"
                        },
                        {
                            "name": "SenderFromDomain",
                            "type": "string"
                        },
                        {
                            "name": "SenderIPv4",
                            "type": "string"
                        },
                        {
                            "name": "SenderIPv6",
                            "type": "dynamic"
                        },
                        {
                            "name": "SenderMailFromAddress",
                            "type": "string"
                        },
                        {
                            "name": "SenderMailFromDomain",
                            "type": "string"
                        },
                        {
                            "name": "SenderObjectId",
                            "type": "dynamic"
                        },
                        {
                            "name": "Subject",
                            "type": "string"
                        },
                        {
                            "name": "ThreatNames",
                            "type": "dynamic"
                        },
                        {
                            "name": "ThreatTypes",
                            "type": "dynamic"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "UrlCount",
                            "type": "int"
                        },
                        {
                            "name": "UserLevelAction",
                            "type": "dynamic"
                        },
                        {
                            "name": "UserLevelPolicy",
                            "type": "dynamic"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/emailurlinfo_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "emailurlinfo_archive_CL",
                    "columns": [
                        {
                            "name": "NetworkMessageId",
                            "type": "string"
                        },
                        {
                            "name": "ReportId",
                            "type": "string"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "Url",
                            "type": "string"
                        },
                        {
                            "name": "UrlDomain",
                            "type": "string"
                        },
                        {
                            "name": "UrlLocation",
                            "type": "string"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/tables",
            "apiVersion": "2021-12-01-preview",
            "name": "[concat(variables('workspaceName'), '/identitylogonevents_archive_CL')]",
            "dependsOn": [
                "[resourceId('Microsoft.OperationalInsights/workspaces', variables('workspaceName'))]"
            ],
            "properties": {
                "plan": "Basic",
                "schema": {
                    "name": "identitylogonevents_archive_CL",
                    "columns": [
                        {
                            "name": "AccountDisplayName",
                            "type": "string"
                        },
                        {
                            "name": "AccountDomain",
                            "type": "string"
                        },
                        {
                            "name": "AccountName",
                            "type": "string"
                        },
                        {
                            "name": "AccountObjectId",
                            "type": "string"
                        },
                        {
                            "name": "AccountSid",
                            "type": "dynamic"
                        },
                        {
                            "name": "AccountUpn",
                            "type": "string"
                        },
                        {
                            "name": "ActionType",
                            "type": "string"
                        },
                        {
                            "name": "AdditionalFields",
                            "type": "dynamic"
                        },
                        {
                            "name": "Application",
                            "type": "string"
                        },
                        {
                            "name": "DestinationDeviceName",
                            "type": "dynamic"
                        },
                        {
                            "name": "DestinationIPAddress",
                            "type": "dynamic"
                        },
                        {
                            "name": "DestinationPort",
                            "type": "dynamic"
                        },
                        {
                            "name": "DeviceName",
                            "type": "dynamic"
                        },
                        {
                            "name": "DeviceType",
                            "type": "string"
                        },
                        {
                            "name": "FailureReason",
                            "type": "dynamic"
                        },
                        {
                            "name": "IPAddress",
                            "type": "string"
                        },
                        {
                            "name": "ISP",
                            "type": "string"
                        },
                        {
                            "name": "Location",
                            "type": "string"
                        },
                        {
                            "name": "LogonType",
                            "type": "string"
                        },
                        {
                            "name": "OSPlatform",
                            "type": "datetime"
                        },
                        {
                            "name": "Port",
                            "type": "dynamic"
                        },
                        {
                            "name": "Protocol",
                            "type": "dynamic"
                        },
                        {
                            "name": "ReportId",
                            "type": "string"
                        },
                        {
                            "name": "TargetAccountDisplayName",
                            "type": "dynamic"
                        },
                        {
                            "name": "TargetDeviceName",
                            "type": "dynamic"
                        },
                        {
                            "name": "Timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        }
                    ]
                }
            }
        },
        {
            "type": "Microsoft.Storage/storageAccounts",
            "apiVersion": "2021-09-01",
            "name": "[parameters('storageAccountName')]",
            "location": "[resourceGroup().location]",
            "sku": {
                "name": "Standard_LRS",
                "tier": "Standard"
            },
            "kind": "StorageV2",
            "properties": {
                "defaultToOAuthAuthentication": false,
                "allowCrossTenantReplication": true,
                "minimumTlsVersion": "TLS1_2",
                "allowBlobPublicAccess": false,
                "allowSharedKeyAccess": true,
                "networkAcls": {
                    "resourceAccessRules": [],
                    "bypass": "AzureServices",
                    "virtualNetworkRules": [],
                    "ipRules": [],
                    "defaultAction": "Deny"
                },
                "supportsHttpsTrafficOnly": true,
                "encryption": {
                    "requireInfrastructureEncryption": false,
                    "services": {
                        "file": {
                            "keyType": "Account",
                            "enabled": true
                        },
                        "blob": {
                            "keyType": "Account",
                            "enabled": true
                        }
                    },
                    "keySource": "Microsoft.Storage"
                },
                "accessTier": "Hot"
            }
        },
        {
            "type": "Microsoft.Storage/storageAccounts/blobServices",
            "apiVersion": "2021-09-01",
            "name": "[concat(parameters('storageAccountName'), '/default')]",
            "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
            ],
            "sku": {
                "name": "Standard_LRS",
                "tier": "Standard"
            },
            "properties": {
                "changeFeed": {
                    "enabled": false
                },
                "restorePolicy": {
                    "enabled": false
                },
                "containerDeleteRetentionPolicy": {
                    "enabled": true,
                    "days": 7
                },
                "cors": {
                    "corsRules": []
                },
                "deleteRetentionPolicy": {
                    "allowPermanentDelete": false,
                    "enabled": true,
                    "days": 7
                },
                "isVersioningEnabled": false
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionEndpoints",
            "apiVersion": "2021-04-01",
            "name": "[variables('dataCollectionEndpointName')]",
            "location": "[resourceGroup().location]",
            "properties": {
                "networkAcls": {
                    "publicNetworkAccess": "Enabled"
                }
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'alertevidence')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-alertevidence_archive_CL": {
                        "columns": [
                            {
                                "name": "AccountDomain",
                                "type": "dynamic"
                            },
                            {
                                "name": "AccountName",
                                "type": "dynamic"
                            },
                            {
                                "name": "AccountObjectId",
                                "type": "dynamic"
                            },
                            {
                                "name": "AccountSid",
                                "type": "dynamic"
                            },
                            {
                                "name": "AccountUpn",
                                "type": "dynamic"
                            },
                            {
                                "name": "AdditionalFields",
                                "type": "string"
                            },
                            {
                                "name": "AlertId",
                                "type": "string"
                            },
                            {
                                "name": "Application",
                                "type": "dynamic"
                            },
                            {
                                "name": "ApplicationId",
                                "type": "dynamic"
                            },
                            {
                                "name": "DeviceId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceName",
                                "type": "string"
                            },
                            {
                                "name": "EmailSubject",
                                "type": "dynamic"
                            },
                            {
                                "name": "EntityType",
                                "type": "string"
                            },
                            {
                                "name": "EvidenceDirection",
                                "type": "dynamic"
                            },
                            {
                                "name": "EvidenceRole",
                                "type": "string"
                            },
                            {
                                "name": "FileName",
                                "type": "dynamic"
                            },
                            {
                                "name": "FileSize",
                                "type": "dynamic"
                            },
                            {
                                "name": "FolderPath",
                                "type": "dynamic"
                            },
                            {
                                "name": "LocalIP",
                                "type": "dynamic"
                            },
                            {
                                "name": "MachineGroup",
                                "type": "string"
                            },
                            {
                                "name": "NetworkMessageId",
                                "type": "dynamic"
                            },
                            {
                                "name": "OAuthApplicationId",
                                "type": "dynamic"
                            },
                            {
                                "name": "ProcessCommandLine",
                                "type": "dynamic"
                            },
                            {
                                "name": "RegistryKey",
                                "type": "dynamic"
                            },
                            {
                                "name": "RegistryValueData",
                                "type": "dynamic"
                            },
                            {
                                "name": "RegistryValueName",
                                "type": "dynamic"
                            },
                            {
                                "name": "RemoteIP",
                                "type": "dynamic"
                            },
                            {
                                "name": "RemoteUrl",
                                "type": "dynamic"
                            },
                            {
                                "name": "ServiceSource",
                                "type": "string"
                            },
                            {
                                "name": "SHA1",
                                "type": "dynamic"
                            },
                            {
                                "name": "SHA256",
                                "type": "dynamic"
                            },
                            {
                                "name": "ThreatFamily",
                                "type": "dynamic"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-alertevidence_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-alertevidence_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'alertinfo')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-alertinfo_archive_CL": {
                        "columns": [
                            {
                                "name": "AlertId",
                                "type": "string"
                            },
                            {
                                "name": "AttackTechniques",
                                "type": "string"
                            },
                            {
                                "name": "Category",
                                "type": "string"
                            },
                            {
                                "name": "DetectionSource",
                                "type": "string"
                            },
                            {
                                "name": "MachineGroup",
                                "type": "string"
                            },
                            {
                                "name": "ServiceSource",
                                "type": "string"
                            },
                            {
                                "name": "Severity",
                                "type": "string"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "Title",
                                "type": "string"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-alertinfo_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-alertinfo_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'cloudappevents')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-cloudappevents_archive_CL": {
                        "columns": [
                            {
                                "name": "AccountDisplayName",
                                "type": "string"
                            },
                            {
                                "name": "AccountId",
                                "type": "string"
                            },
                            {
                                "name": "AccountObjectId",
                                "type": "dynamic"
                            },
                            {
                                "name": "AccountType",
                                "type": "string"
                            },
                            {
                                "name": "ActionType",
                                "type": "string"
                            },
                            {
                                "name": "ActivityObjects",
                                "type": "dynamic"
                            },
                            {
                                "name": "ActivityType",
                                "type": "string"
                            },
                            {
                                "name": "AdditionalFields",
                                "type": "dynamic"
                            },
                            {
                                "name": "AppInstanceId",
                                "type": "int"
                            },
                            {
                                "name": "Application",
                                "type": "datetime"
                            },
                            {
                                "name": "ApplicationId",
                                "type": "int"
                            },
                            {
                                "name": "City",
                                "type": "dynamic"
                            },
                            {
                                "name": "CountryCode",
                                "type": "dynamic"
                            },
                            {
                                "name": "DeviceType",
                                "type": "string"
                            },
                            {
                                "name": "IPAddress",
                                "type": "dynamic"
                            },
                            {
                                "name": "IPCategory",
                                "type": "dynamic"
                            },
                            {
                                "name": "IPTags",
                                "type": "dynamic"
                            },
                            {
                                "name": "IsAdminOperation",
                                "type": "boolean"
                            },
                            {
                                "name": "IsAnonymousProxy",
                                "type": "dynamic"
                            },
                            {
                                "name": "IsExternalUser",
                                "type": "boolean"
                            },
                            {
                                "name": "IsImpersonated",
                                "type": "boolean"
                            },
                            {
                                "name": "ISP",
                                "type": "dynamic"
                            },
                            {
                                "name": "ObjectId",
                                "type": "dynamic"
                            },
                            {
                                "name": "ObjectName",
                                "type": "dynamic"
                            },
                            {
                                "name": "ObjectType",
                                "type": "dynamic"
                            },
                            {
                                "name": "OSPlatform",
                                "type": "string"
                            },
                            {
                                "name": "RawEventData",
                                "type": "dynamic"
                            },
                            {
                                "name": "ReportId",
                                "type": "string"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "UserAgent",
                                "type": "string"
                            },
                            {
                                "name": "UserAgentTags",
                                "type": "dynamic"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-cloudappevents_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-cloudappevents_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'deviceevents')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-deviceevents_archive_CL": {
                        "columns": [
                            {
                                "name": "AccountDomain",
                                "type": "dynamic"
                            },
                            {
                                "name": "AccountName",
                                "type": "dynamic"
                            },
                            {
                                "name": "AccountSid",
                                "type": "dynamic"
                            },
                            {
                                "name": "ActionType",
                                "type": "string"
                            },
                            {
                                "name": "AdditionalFields",
                                "type": "string"
                            },
                            {
                                "name": "AppGuardContainerId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceName",
                                "type": "string"
                            },
                            {
                                "name": "FileName",
                                "type": "dynamic"
                            },
                            {
                                "name": "FileOriginIP",
                                "type": "dynamic"
                            },
                            {
                                "name": "FileOriginUrl",
                                "type": "dynamic"
                            },
                            {
                                "name": "FileSize",
                                "type": "int"
                            },
                            {
                                "name": "FolderPath",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessAccountDomain",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountObjectId",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessAccountSid",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessAccountUpn",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessCommandLine",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessCreationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessFileSize",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessFolderPath",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessId",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessLogonId",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessMD5",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessParentCreationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessParentFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessParentId",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessSHA1",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessSHA256",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoCompanyName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoFileDescription",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoInternalFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoOriginalFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoProductName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoProductVersion",
                                "type": "string"
                            },
                            {
                                "name": "LocalIP",
                                "type": "dynamic"
                            },
                            {
                                "name": "LocalPort",
                                "type": "dynamic"
                            },
                            {
                                "name": "LogonId",
                                "type": "dynamic"
                            },
                            {
                                "name": "MachineGroup",
                                "type": "string"
                            },
                            {
                                "name": "MD5",
                                "type": "dynamic"
                            },
                            {
                                "name": "ProcessCommandLine",
                                "type": "dynamic"
                            },
                            {
                                "name": "ProcessCreationTime",
                                "type": "dynamic"
                            },
                            {
                                "name": "ProcessId",
                                "type": "dynamic"
                            },
                            {
                                "name": "ProcessTokenElevation",
                                "type": "dynamic"
                            },
                            {
                                "name": "RegistryKey",
                                "type": "dynamic"
                            },
                            {
                                "name": "RegistryValueData",
                                "type": "dynamic"
                            },
                            {
                                "name": "RegistryValueName",
                                "type": "dynamic"
                            },
                            {
                                "name": "RemoteDeviceName",
                                "type": "dynamic"
                            },
                            {
                                "name": "RemoteIP",
                                "type": "dynamic"
                            },
                            {
                                "name": "RemotePort",
                                "type": "dynamic"
                            },
                            {
                                "name": "RemoteUrl",
                                "type": "dynamic"
                            },
                            {
                                "name": "ReportId",
                                "type": "int"
                            },
                            {
                                "name": "SHA1",
                                "type": "dynamic"
                            },
                            {
                                "name": "SHA256",
                                "type": "dynamic"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-deviceevents_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-deviceevents_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'devicefilecertificateinfo')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-devicefilecertificateinfo_archive_CL": {
                        "columns": [
                            {
                                "name": "CertificateCountersignatureTime",
                                "type": "datetime"
                            },
                            {
                                "name": "CertificateCreationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "CertificateExpirationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "CertificateSerialNumber",
                                "type": "string"
                            },
                            {
                                "name": "CrlDistributionPointUrls",
                                "type": "string"
                            },
                            {
                                "name": "DeviceId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceName",
                                "type": "string"
                            },
                            {
                                "name": "IsRootSignerMicrosoft",
                                "type": "boolean"
                            },
                            {
                                "name": "IsSigned",
                                "type": "boolean"
                            },
                            {
                                "name": "Issuer",
                                "type": "datetime"
                            },
                            {
                                "name": "IssuerHash",
                                "type": "string"
                            },
                            {
                                "name": "IsTrusted",
                                "type": "boolean"
                            },
                            {
                                "name": "MachineGroup",
                                "type": "string"
                            },
                            {
                                "name": "ReportId",
                                "type": "int"
                            },
                            {
                                "name": "SHA1",
                                "type": "string"
                            },
                            {
                                "name": "SignatureType",
                                "type": "string"
                            },
                            {
                                "name": "Signer",
                                "type": "string"
                            },
                            {
                                "name": "SignerHash",
                                "type": "string"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-devicefilecertificateinfo_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-devicefilecertificateinfo_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'devicefileevents')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-devicefileevents_archive_CL": {
                        "columns": [
                            {
                                "name": "ActionType",
                                "type": "string"
                            },
                            {
                                "name": "AdditionalFields",
                                "type": "dynamic"
                            },
                            {
                                "name": "AppGuardContainerId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceName",
                                "type": "string"
                            },
                            {
                                "name": "FileName",
                                "type": "string"
                            },
                            {
                                "name": "FileOriginIP",
                                "type": "dynamic"
                            },
                            {
                                "name": "FileOriginReferrerUrl",
                                "type": "dynamic"
                            },
                            {
                                "name": "FileOriginUrl",
                                "type": "dynamic"
                            },
                            {
                                "name": "FileSize",
                                "type": "int"
                            },
                            {
                                "name": "FolderPath",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountDomain",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountObjectId",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessAccountSid",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessAccountUpn",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessCommandLine",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessCreationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessFileSize",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessFolderPath",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessId",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessIntegrityLevel",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessMD5",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessParentCreationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessParentFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessParentId",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessSHA1",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessSHA256",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessTokenElevation",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoCompanyName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoFileDescription",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoInternalFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoOriginalFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoProductName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoProductVersion",
                                "type": "string"
                            },
                            {
                                "name": "IsAzureInfoProtectionApplied",
                                "type": "dynamic"
                            },
                            {
                                "name": "MachineGroup",
                                "type": "string"
                            },
                            {
                                "name": "MD5",
                                "type": "string"
                            },
                            {
                                "name": "PreviousFileName",
                                "type": "string"
                            },
                            {
                                "name": "PreviousFolderPath",
                                "type": "string"
                            },
                            {
                                "name": "ReportId",
                                "type": "int"
                            },
                            {
                                "name": "RequestAccountDomain",
                                "type": "string"
                            },
                            {
                                "name": "RequestAccountName",
                                "type": "string"
                            },
                            {
                                "name": "RequestAccountSid",
                                "type": "datetime"
                            },
                            {
                                "name": "RequestProtocol",
                                "type": "string"
                            },
                            {
                                "name": "RequestSourceIP",
                                "type": "dynamic"
                            },
                            {
                                "name": "RequestSourcePort",
                                "type": "dynamic"
                            },
                            {
                                "name": "SensitivityLabel",
                                "type": "dynamic"
                            },
                            {
                                "name": "SensitivitySubLabel",
                                "type": "dynamic"
                            },
                            {
                                "name": "SHA1",
                                "type": "string"
                            },
                            {
                                "name": "SHA256",
                                "type": "string"
                            },
                            {
                                "name": "ShareName",
                                "type": "dynamic"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-devicefileevents_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-devicefileevents_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'deviceimageloadevents')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-deviceimageloadevents_archive_CL": {
                        "columns": [
                            {
                                "name": "ActionType",
                                "type": "string"
                            },
                            {
                                "name": "AppGuardContainerId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceName",
                                "type": "string"
                            },
                            {
                                "name": "FileName",
                                "type": "string"
                            },
                            {
                                "name": "FileSize",
                                "type": "int"
                            },
                            {
                                "name": "FolderPath",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountDomain",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountObjectId",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessAccountSid",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountUpn",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessCommandLine",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessCreationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessFileSize",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessFolderPath",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessId",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessIntegrityLevel",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessMD5",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessParentCreationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessParentFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessParentId",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessSHA1",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessSHA256",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessTokenElevation",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoCompanyName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoFileDescription",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoInternalFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoOriginalFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoProductName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoProductVersion",
                                "type": "string"
                            },
                            {
                                "name": "MachineGroup",
                                "type": "string"
                            },
                            {
                                "name": "MD5",
                                "type": "string"
                            },
                            {
                                "name": "ReportId",
                                "type": "int"
                            },
                            {
                                "name": "SHA1",
                                "type": "string"
                            },
                            {
                                "name": "SHA256",
                                "type": "string"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-deviceimageloadevents_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-deviceimageloadevents_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'deviceinfo')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-deviceinfo_archive_CL": {
                        "columns": [
                            {
                                "name": "AadDeviceId",
                                "type": "string"
                            },
                            {
                                "name": "AdditionalFields",
                                "type": "string"
                            },
                            {
                                "name": "ClientVersion",
                                "type": "string"
                            },
                            {
                                "name": "DeviceId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceName",
                                "type": "string"
                            },
                            {
                                "name": "DeviceObjectId",
                                "type": "string"
                            },
                            {
                                "name": "IsAzureADJoined",
                                "type": "boolean"
                            },
                            {
                                "name": "JoinType",
                                "type": "string"
                            },
                            {
                                "name": "LoggedOnUsers",
                                "type": "string"
                            },
                            {
                                "name": "MachineGroup",
                                "type": "string"
                            },
                            {
                                "name": "OnboardingStatus",
                                "type": "string"
                            },
                            {
                                "name": "OSArchitecture",
                                "type": "dynamic"
                            },
                            {
                                "name": "OSBuild",
                                "type": "dynamic"
                            },
                            {
                                "name": "OSPlatform",
                                "type": "dynamic"
                            },
                            {
                                "name": "OSVersion",
                                "type": "dynamic"
                            },
                            {
                                "name": "PublicIP",
                                "type": "string"
                            },
                            {
                                "name": "RegistryDeviceTag",
                                "type": "dynamic"
                            },
                            {
                                "name": "ReportId",
                                "type": "int"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-deviceinfo_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-deviceinfo_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'devicelogonevents')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-devicelogonevents_archive_CL": {
                        "columns": [
                            {
                                "name": "AccountDomain",
                                "type": "string"
                            },
                            {
                                "name": "AccountName",
                                "type": "datetime"
                            },
                            {
                                "name": "AccountSid",
                                "type": "dynamic"
                            },
                            {
                                "name": "ActionType",
                                "type": "string"
                            },
                            {
                                "name": "AdditionalFields",
                                "type": "string"
                            },
                            {
                                "name": "AppGuardContainerId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceName",
                                "type": "string"
                            },
                            {
                                "name": "FailureReason",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessAccountDomain",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountObjectId",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessAccountSid",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessAccountUpn",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessCommandLine",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessCreationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessFileSize",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessFolderPath",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessId",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessIntegrityLevel",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessMD5",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessParentCreationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessParentFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessParentId",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessSHA1",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessSHA256",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessTokenElevation",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoCompanyName",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoFileDescription",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoInternalFileName",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoOriginalFileName",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoProductName",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoProductVersion",
                                "type": "dynamic"
                            },
                            {
                                "name": "IsLocalAdmin",
                                "type": "dynamic"
                            },
                            {
                                "name": "LogonId",
                                "type": "dynamic"
                            },
                            {
                                "name": "LogonType",
                                "type": "string"
                            },
                            {
                                "name": "MachineGroup",
                                "type": "string"
                            },
                            {
                                "name": "Protocol",
                                "type": "dynamic"
                            },
                            {
                                "name": "RemoteDeviceName",
                                "type": "dynamic"
                            },
                            {
                                "name": "RemoteIP",
                                "type": "string"
                            },
                            {
                                "name": "RemoteIPType",
                                "type": "dynamic"
                            },
                            {
                                "name": "RemotePort",
                                "type": "dynamic"
                            },
                            {
                                "name": "ReportId",
                                "type": "int"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-devicelogonevents_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-devicelogonevents_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'devicenetworkevents')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-devicenetworkevents_archive_CL": {
                        "columns": [
                            {
                                "name": "ActionType",
                                "type": "string"
                            },
                            {
                                "name": "AdditionalFields",
                                "type": "dynamic"
                            },
                            {
                                "name": "AppGuardContainerId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountDomain",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountObjectId",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessAccountSid",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessAccountUpn",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessCommandLine",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessCreationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessFileSize",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessFolderPath",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessId",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessIntegrityLevel",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessMD5",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessParentCreationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessParentFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessParentId",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessSHA1",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessSHA256",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessTokenElevation",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoCompanyName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoFileDescription",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoInternalFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoOriginalFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoProductName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoProductVersion",
                                "type": "string"
                            },
                            {
                                "name": "LocalIP",
                                "type": "string"
                            },
                            {
                                "name": "LocalIPType",
                                "type": "string"
                            },
                            {
                                "name": "LocalPort",
                                "type": "int"
                            },
                            {
                                "name": "MachineGroup",
                                "type": "string"
                            },
                            {
                                "name": "Protocol",
                                "type": "string"
                            },
                            {
                                "name": "RemoteIP",
                                "type": "string"
                            },
                            {
                                "name": "RemoteIPType",
                                "type": "string"
                            },
                            {
                                "name": "RemotePort",
                                "type": "int"
                            },
                            {
                                "name": "RemoteUrl",
                                "type": "string"
                            },
                            {
                                "name": "ReportId",
                                "type": "int"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-devicenetworkevents_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-devicenetworkevents_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'devicenetworkinfo')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-devicenetworkinfo_archive_CL": {
                        "columns": [
                            {
                                "name": "ConnectedNetworks",
                                "type": "string"
                            },
                            {
                                "name": "DefaultGateways",
                                "type": "string"
                            },
                            {
                                "name": "DeviceId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceName",
                                "type": "string"
                            },
                            {
                                "name": "DnsAddresses",
                                "type": "string"
                            },
                            {
                                "name": "IPAddresses",
                                "type": "string"
                            },
                            {
                                "name": "IPv4Dhcp",
                                "type": "string"
                            },
                            {
                                "name": "IPv6Dhcp",
                                "type": "string"
                            },
                            {
                                "name": "MacAddress",
                                "type": "string"
                            },
                            {
                                "name": "MachineGroup",
                                "type": "string"
                            },
                            {
                                "name": "NetworkAdapterName",
                                "type": "string"
                            },
                            {
                                "name": "NetworkAdapterStatus",
                                "type": "string"
                            },
                            {
                                "name": "NetworkAdapterType",
                                "type": "string"
                            },
                            {
                                "name": "ReportId",
                                "type": "int"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "TunnelType",
                                "type": "string"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-devicenetworkinfo_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-devicenetworkinfo_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'deviceprocessevents')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-deviceprocessevents_archive_CL": {
                        "columns": [
                            {
                                "name": "AccountDomain",
                                "type": "string"
                            },
                            {
                                "name": "AccountName",
                                "type": "string"
                            },
                            {
                                "name": "AccountObjectId",
                                "type": "dynamic"
                            },
                            {
                                "name": "AccountSid",
                                "type": "datetime"
                            },
                            {
                                "name": "AccountUpn",
                                "type": "dynamic"
                            },
                            {
                                "name": "ActionType",
                                "type": "string"
                            },
                            {
                                "name": "AdditionalFields",
                                "type": "dynamic"
                            },
                            {
                                "name": "AppGuardContainerId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceName",
                                "type": "string"
                            },
                            {
                                "name": "FileName",
                                "type": "string"
                            },
                            {
                                "name": "FileSize",
                                "type": "int"
                            },
                            {
                                "name": "FolderPath",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountDomain",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountObjectId",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessAccountSid",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessAccountUpn",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessCommandLine",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessCreationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessFileSize",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessFolderPath",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessId",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessIntegrityLevel",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessLogonId",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessMD5",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessParentCreationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessParentFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessParentId",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessSHA1",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessSHA256",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessSignatureStatus",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessSignerType",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessTokenElevation",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoCompanyName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoFileDescription",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoInternalFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoOriginalFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoProductName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoProductVersion",
                                "type": "string"
                            },
                            {
                                "name": "LogonId",
                                "type": "int"
                            },
                            {
                                "name": "MachineGroup",
                                "type": "string"
                            },
                            {
                                "name": "MD5",
                                "type": "string"
                            },
                            {
                                "name": "ProcessCommandLine",
                                "type": "string"
                            },
                            {
                                "name": "ProcessCreationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "ProcessId",
                                "type": "int"
                            },
                            {
                                "name": "ProcessIntegrityLevel",
                                "type": "string"
                            },
                            {
                                "name": "ProcessTokenElevation",
                                "type": "string"
                            },
                            {
                                "name": "ProcessVersionInfoCompanyName",
                                "type": "string"
                            },
                            {
                                "name": "ProcessVersionInfoFileDescription",
                                "type": "string"
                            },
                            {
                                "name": "ProcessVersionInfoInternalFileName",
                                "type": "string"
                            },
                            {
                                "name": "ProcessVersionInfoOriginalFileName",
                                "type": "string"
                            },
                            {
                                "name": "ProcessVersionInfoProductName",
                                "type": "string"
                            },
                            {
                                "name": "ProcessVersionInfoProductVersion",
                                "type": "string"
                            },
                            {
                                "name": "ReportId",
                                "type": "int"
                            },
                            {
                                "name": "SHA1",
                                "type": "string"
                            },
                            {
                                "name": "SHA256",
                                "type": "string"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-deviceprocessevents_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-deviceprocessevents_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'deviceregistryevents')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-deviceregistryevents_archive_CL": {
                        "columns": [
                            {
                                "name": "ActionType",
                                "type": "string"
                            },
                            {
                                "name": "AppGuardContainerId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceId",
                                "type": "string"
                            },
                            {
                                "name": "DeviceName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountDomain",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessAccountObjectId",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessAccountSid",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessAccountUpn",
                                "type": "dynamic"
                            },
                            {
                                "name": "InitiatingProcessCommandLine",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessCreationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessFileSize",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessFolderPath",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessId",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessIntegrityLevel",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessMD5",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessParentCreationTime",
                                "type": "datetime"
                            },
                            {
                                "name": "InitiatingProcessParentFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessParentId",
                                "type": "int"
                            },
                            {
                                "name": "InitiatingProcessSHA1",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessSHA256",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessTokenElevation",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoCompanyName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoFileDescription",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoInternalFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoOriginalFileName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoProductName",
                                "type": "string"
                            },
                            {
                                "name": "InitiatingProcessVersionInfoProductVersion",
                                "type": "string"
                            },
                            {
                                "name": "MachineGroup",
                                "type": "string"
                            },
                            {
                                "name": "PreviousRegistryKey",
                                "type": "string"
                            },
                            {
                                "name": "PreviousRegistryValueData",
                                "type": "dynamic"
                            },
                            {
                                "name": "PreviousRegistryValueName",
                                "type": "dynamic"
                            },
                            {
                                "name": "RegistryKey",
                                "type": "string"
                            },
                            {
                                "name": "RegistryValueData",
                                "type": "dynamic"
                            },
                            {
                                "name": "RegistryValueName",
                                "type": "dynamic"
                            },
                            {
                                "name": "RegistryValueType",
                                "type": "string"
                            },
                            {
                                "name": "ReportId",
                                "type": "int"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-deviceregistryevents_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-deviceregistryevents_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'emailattachmentinfo')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-emailattachmentinfo_archive_CL": {
                        "columns": [
                            {
                                "name": "DetectionMethods",
                                "type": "dynamic"
                            },
                            {
                                "name": "FileName",
                                "type": "string"
                            },
                            {
                                "name": "FileSize",
                                "type": "int"
                            },
                            {
                                "name": "FileType",
                                "type": "string"
                            },
                            {
                                "name": "NetworkMessageId",
                                "type": "string"
                            },
                            {
                                "name": "RecipientEmailAddress",
                                "type": "string"
                            },
                            {
                                "name": "RecipientObjectId",
                                "type": "dynamic"
                            },
                            {
                                "name": "ReportId",
                                "type": "string"
                            },
                            {
                                "name": "SenderDisplayName",
                                "type": "dynamic"
                            },
                            {
                                "name": "SenderFromAddress",
                                "type": "string"
                            },
                            {
                                "name": "SenderObjectId",
                                "type": "dynamic"
                            },
                            {
                                "name": "SHA256",
                                "type": "string"
                            },
                            {
                                "name": "ThreatNames",
                                "type": "dynamic"
                            },
                            {
                                "name": "ThreatTypes",
                                "type": "dynamic"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-emailattachmentinfo_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-emailattachmentinfo_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'emailevents')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-emailevents_archive_CL": {
                        "columns": [
                            {
                                "name": "AdditionalFields",
                                "type": "dynamic"
                            },
                            {
                                "name": "AttachmentCount",
                                "type": "int"
                            },
                            {
                                "name": "AuthenticationDetails",
                                "type": "string"
                            },
                            {
                                "name": "ConfidenceLevel",
                                "type": "dynamic"
                            },
                            {
                                "name": "Connectors",
                                "type": "dynamic"
                            },
                            {
                                "name": "DeliveryAction",
                                "type": "string"
                            },
                            {
                                "name": "DeliveryLocation",
                                "type": "string"
                            },
                            {
                                "name": "DetectionMethods",
                                "type": "dynamic"
                            },
                            {
                                "name": "EmailAction",
                                "type": "dynamic"
                            },
                            {
                                "name": "EmailActionPolicy",
                                "type": "dynamic"
                            },
                            {
                                "name": "EmailActionPolicyGuid",
                                "type": "dynamic"
                            },
                            {
                                "name": "EmailClusterId",
                                "type": "long"
                            },
                            {
                                "name": "EmailDirection",
                                "type": "string"
                            },
                            {
                                "name": "EmailLanguage",
                                "type": "string"
                            },
                            {
                                "name": "InternetMessageId",
                                "type": "string"
                            },
                            {
                                "name": "NetworkMessageId",
                                "type": "string"
                            },
                            {
                                "name": "OrgLevelAction",
                                "type": "dynamic"
                            },
                            {
                                "name": "OrgLevelPolicy",
                                "type": "dynamic"
                            },
                            {
                                "name": "RecipientEmailAddress",
                                "type": "string"
                            },
                            {
                                "name": "RecipientObjectId",
                                "type": "string"
                            },
                            {
                                "name": "ReportId",
                                "type": "string"
                            },
                            {
                                "name": "SenderDisplayName",
                                "type": "string"
                            },
                            {
                                "name": "SenderFromAddress",
                                "type": "string"
                            },
                            {
                                "name": "SenderFromDomain",
                                "type": "string"
                            },
                            {
                                "name": "SenderIPv4",
                                "type": "string"
                            },
                            {
                                "name": "SenderIPv6",
                                "type": "dynamic"
                            },
                            {
                                "name": "SenderMailFromAddress",
                                "type": "string"
                            },
                            {
                                "name": "SenderMailFromDomain",
                                "type": "string"
                            },
                            {
                                "name": "SenderObjectId",
                                "type": "dynamic"
                            },
                            {
                                "name": "Subject",
                                "type": "string"
                            },
                            {
                                "name": "ThreatNames",
                                "type": "dynamic"
                            },
                            {
                                "name": "ThreatTypes",
                                "type": "dynamic"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "UrlCount",
                                "type": "int"
                            },
                            {
                                "name": "UserLevelAction",
                                "type": "dynamic"
                            },
                            {
                                "name": "UserLevelPolicy",
                                "type": "dynamic"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-emailevents_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-emailevents_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'emailurlinfo')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-emailurlinfo_archive_CL": {
                        "columns": [
                            {
                                "name": "NetworkMessageId",
                                "type": "string"
                            },
                            {
                                "name": "ReportId",
                                "type": "string"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "Url",
                                "type": "string"
                            },
                            {
                                "name": "UrlDomain",
                                "type": "string"
                            },
                            {
                                "name": "UrlLocation",
                                "type": "string"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-emailurlinfo_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-emailurlinfo_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Insights/dataCollectionRules",
            "apiVersion": "2021-09-01-preview",
            "name": "[concat(variables('dataCollectionRulePrefix'), 'identitylogonevents')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
            ],
            "properties": {
                "dataCollectionEndpointId": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "streamDeclarations": {
                    "Custom-identitylogonevents_archive_CL": {
                        "columns": [
                            {
                                "name": "AccountDisplayName",
                                "type": "string"
                            },
                            {
                                "name": "AccountDomain",
                                "type": "string"
                            },
                            {
                                "name": "AccountName",
                                "type": "string"
                            },
                            {
                                "name": "AccountObjectId",
                                "type": "string"
                            },
                            {
                                "name": "AccountSid",
                                "type": "dynamic"
                            },
                            {
                                "name": "AccountUpn",
                                "type": "string"
                            },
                            {
                                "name": "ActionType",
                                "type": "string"
                            },
                            {
                                "name": "AdditionalFields",
                                "type": "dynamic"
                            },
                            {
                                "name": "Application",
                                "type": "string"
                            },
                            {
                                "name": "DestinationDeviceName",
                                "type": "dynamic"
                            },
                            {
                                "name": "DestinationIPAddress",
                                "type": "dynamic"
                            },
                            {
                                "name": "DestinationPort",
                                "type": "dynamic"
                            },
                            {
                                "name": "DeviceName",
                                "type": "dynamic"
                            },
                            {
                                "name": "DeviceType",
                                "type": "string"
                            },
                            {
                                "name": "FailureReason",
                                "type": "dynamic"
                            },
                            {
                                "name": "IPAddress",
                                "type": "string"
                            },
                            {
                                "name": "ISP",
                                "type": "string"
                            },
                            {
                                "name": "Location",
                                "type": "string"
                            },
                            {
                                "name": "LogonType",
                                "type": "string"
                            },
                            {
                                "name": "OSPlatform",
                                "type": "datetime"
                            },
                            {
                                "name": "Port",
                                "type": "dynamic"
                            },
                            {
                                "name": "Protocol",
                                "type": "dynamic"
                            },
                            {
                                "name": "ReportId",
                                "type": "string"
                            },
                            {
                                "name": "TargetAccountDisplayName",
                                "type": "dynamic"
                            },
                            {
                                "name": "TargetDeviceName",
                                "type": "dynamic"
                            },
                            {
                                "name": "Timestamp",
                                "type": "datetime"
                            },
                            {
                                "name": "TimeGenerated",
                                "type": "datetime"
                            }
                        ]
                    }
                },
                "destinations": {
                    "logAnalytics": [
                        {
                            "workspaceResourceId": "[resourceId('microsoft.operationalinsights/workspaces', variables('workspaceName'))]",
                            "name": "[variables('uniqueDestinationString')]"
                        }
                    ]
                },
                "dataFlows": [
                    {
                        "streams": [
                            "Custom-identitylogonevents_archive_CL"
                        ],
                        "destinations": [
                            "[variables('uniqueDestinationString')]"
                        ],
                        "transformKql": "source | extend TimeGenerated = now()",
                        "outputStream": "Custom-identitylogonevents_archive_CL"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Logic/integrationAccounts",
            "apiVersion": "2016-06-01",
            "name": "[variables('integrationAccountName')]",
            "location": "[resourceGroup().location]",
            "sku": {
                "name": "Free"
            },
            "properties": {
                "state": "Enabled"
            }
        },
        {
            "type": "Microsoft.Web/connections",
            "apiVersion": "2018-07-01-preview",
            "name": "[variables('logicAppConnectionName')]",
            "location": "[resourceGroup().location]",
            "kind": "V1",
            "properties": {
                "alternativeParameterValues": {},
                "api": {
                    "id": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', resourceGroup().location, '/managedApis/azureblob')]"
                },
                "customParameterValues": {},
                "displayName": "[variables('logicAppConnectionName')]",
                "parameterValueSet": {
                    "name": "managedIdentityAuth",
                    "values": {}
                }
            }
        },
        {
            "type": "Microsoft.Logic/workflows",
            "apiVersion": "2017-07-01",
            "name": "[variables('logicAppName')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('Microsoft.Logic/integrationAccounts', variables('integrationAccountName'))]",
                "[resourceId('Microsoft.Web/connections', variables('logicAppConnectionName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'alertevidence'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'alertinfo'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'cloudappevents'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'deviceevents'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'devicefilecertificateinfo'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'devicefileevents'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'deviceimageloadevents'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'deviceinfo'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'devicelogonevents'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'devicenetworkevents'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'devicenetworkinfo'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'deviceprocessevents'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'deviceregistryevents'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'emailattachmentinfo'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'emailevents'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'emailurlinfo'))]",
                "[resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'identitylogonevents'))]"
            ],
            "identity": {
                "type": "SystemAssigned"
            },
            "properties": {
                "state": "Enabled",
                "integrationAccount": {
                    "id": "[resourceId('Microsoft.Logic/integrationAccounts', variables('integrationAccountName'))]"
                },
                "definition": {
                    "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                    "actions": {
                        "For_each_blob_root_folder": {
                            "actions": {
                                "Compose_custom_log_table_name": {
                                    "inputs": "@concat(split(items('For_each_blob_root_folder')?['Name'],'-')[3],variables('customTableSuffix'))",
                                    "runAfter": {},
                                    "type": "Compose"
                                },
                                "Compose_full_dcrName": {
                                    "inputs": "@concat('dcr-', variables('dcrPrefix'), '-', split(items('For_each_blob_root_folder')?['Name'],'-')[3])",
                                    "runAfter": {
                                        "Compose_custom_log_table_name": [
                                            "Succeeded"
                                        ]
                                    },
                                    "type": "Compose"
                                },
                                "For_each_hourly_sub-container": {
                                    "actions": {
                                        "Compose_body_by_fixing_JSON_structure": {
                                            "inputs": "@{concat('[',replace(string(body('Get_blob_contents')),'\r\n{',',{'),']')}",
                                            "runAfter": {
                                                "Get_blob_contents": [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type": "Compose"
                                        },
                                        "For_each_data_element": {
                                            "actions": {
                                                "Post_logfile_to_Data_Collection_Endpoint": {
                                                    "inputs": {
                                                        "authentication": {
                                                            "audience": "https://monitor.azure.com/",
                                                            "type": "ManagedServiceIdentity"
                                                        },
                                                        "body": [
                                                            "@items('For_each_data_element')?['properties']"
                                                        ],
                                                        "headers": {
                                                            "Content-Type": "application/json"
                                                        },
                                                        "method": "POST",
                                                        "uri": "@{variables('dceUri')}/dataCollectionRules/@{body('Retrieve_respective_dcrImmutableId')}/streams/Custom-@{outputs('Compose_custom_log_table_name')}?api-version=2021-11-01-preview"
                                                    },
                                                    "runAfter": {},
                                                    "type": "Http"
                                                }
                                            },
                                            "foreach": "@body('Parse_string_into_JSON_array_so_that_only_''properties''_can_be_processed')",
                                            "runAfter": {
                                                "Parse_string_into_JSON_array_so_that_only_'properties'_can_be_processed": [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type": "Foreach"
                                        },
                                        "Get_blob_contents": {
                                            "inputs": {
                                                "host": {
                                                    "connection": {
                                                        "name": "@parameters('$connections')['azureblob']['connectionId']"
                                                    }
                                                },
                                                "method": "get",
                                                "path": "/v2/datasets/@{encodeURIComponent(encodeURIComponent(variables('storageAccountName')))}/GetFileContentByPath",
                                                "queries": {
                                                    "inferContentType": true,
                                                    "path": "/@{items('For_each_blob_root_folder')?['Name']}/tenantId=@{variables('tenantId')}/y=@{variables('year')}/m=@{variables('month')}/d=@{variables('day')}/@{items('For_each_hourly_sub-container')?['Name']}m=00/PT1H.json",
                                                    "queryParametersSingleEncoded": true
                                                }
                                            },
                                            "runAfter": {},
                                            "type": "ApiConnection"
                                        },
                                        "Parse_string_into_JSON_array_so_that_only_'properties'_can_be_processed": {
                                            "inputs": {
                                                "content": "@outputs('Compose_body_by_fixing_JSON_structure')",
                                                "schema": {
                                                    "items": {
                                                        "properties": {
                                                            "properties": {
                                                                "type": "object"
                                                            }
                                                        },
                                                        "type": "object"
                                                    },
                                                    "type": "array"
                                                }
                                            },
                                            "runAfter": {
                                                "Compose_body_by_fixing_JSON_structure": [
                                                    "Succeeded"
                                                ]
                                            },
                                            "type": "ParseJson"
                                        }
                                    },
                                    "foreach": "@body('Lists_blob_sub-containers_(hourly_folders)')?['value']",
                                    "runAfter": {
                                        "Lists_blob_sub-containers_(hourly_folders)": [
                                            "Succeeded"
                                        ]
                                    },
                                    "type": "Foreach"
                                },
                                "Lists_blob_sub-containers_(hourly_folders)": {
                                    "inputs": {
                                        "host": {
                                            "connection": {
                                                "name": "@parameters('$connections')['azureblob']['connectionId']"
                                            }
                                        },
                                        "method": "get",
                                        "path": "/v2/datasets/@{encodeURIComponent(encodeURIComponent(variables('storageAccountName')))}/foldersV2/@{encodeURIComponent(encodeURIComponent('/',items('For_each_blob_root_folder')?['Name'],'/tenantId=',variables('tenantId'),'/y=',variables('year'),'/m=',variables('month'),'/d=',variables('day')))}",
                                        "queries": {
                                            "nextPageMarker": "",
                                            "useFlatListing": false
                                        }
                                    },
                                    "runAfter": {
                                        "Retrieve_respective_dcrImmutableId": [
                                            "Succeeded"
                                        ]
                                    },
                                    "type": "ApiConnection"
                                },
                                "Retrieve_respective_dcrImmutableId": {
                                    "inputs": {
                                        "code": "var content = workflowContext.actions.Parse_dataCollectionRules.outputs.body.content;\r\n\r\nvar dcrName = \"\" + workflowContext.actions.Compose_full_dcrName.outputs;\r\n\r\nvar result = \"\";\r\n\r\ncontent.forEach(item=>{\r\n    if(item.dcrName == dcrName){\r\n        result = item.dcrImmutableId;\r\n    }\r\n});\r\n\r\nreturn result;"
                                    },
                                    "runAfter": {
                                        "Compose_full_dcrName": [
                                            "Succeeded"
                                        ]
                                    },
                                    "type": "JavaScriptCode"
                                }
                            },
                            "foreach": "@body('Lists_blobs_in_the_root_folder')?['value']",
                            "runAfter": {
                                "Lists_blobs_in_the_root_folder": [
                                    "Succeeded"
                                ]
                            },
                            "type": "Foreach"
                        },
                        "Initialize_'customTableSuffix'_variable": {
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "customTableSuffix",
                                        "type": "string",
                                        "value": "_archive_CL"
                                    }
                                ]
                            },
                            "runAfter": {
                                "Initialize_'dcrPrefix'_variable": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable"
                        },
                        "Initialize_'dataCollectionRules'_variable": {
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "dataCollectionRules",
                                        "type": "string",
                                        "value": "[concat( '{ \"content\": [ { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'alertevidence', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'alertevidence')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'alertinfo', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'alertinfo')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'cloudappevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'cloudappevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'deviceevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'deviceevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'devicefilecertificateinfo', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'devicefilecertificateinfo')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'devicefileevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'devicefileevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'deviceimageloadevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'deviceimageloadevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'deviceinfo', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'deviceinfo')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'devicelogonevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'devicelogonevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'devicenetworkevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'devicenetworkevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'devicenetworkinfo', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'devicenetworkinfo')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'deviceprocessevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'deviceprocessevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'deviceregistryevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'deviceregistryevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'emailattachmentinfo', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'emailattachmentinfo')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'emailevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'emailevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'emailurlinfo', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'emailurlinfo')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'identitylogonevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'identitylogonevents')), '2021-04-01', 'full').properties.immutableId, '\" } ] }')]"
                                    }
                                ]
                            },
                            "runAfter": {
                                "Initialize_'customTableSuffix'_variable": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable"
                        },
                        "Initialize_'day'_variable": {
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "day",
                                        "type": "string",
                                        "value": "@{formatDateTime(addDays(utcNow(), -1), 'dd')}"
                                    }
                                ]
                            },
                            "runAfter": {
                                "Initialize_'month'_variable": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable"
                        },
                        "Initialize_'dceUri'_variable": {
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "dceUri",
                                        "type": "string",
                                        "value": "[reference(resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName')), '2021-04-01', 'full').properties.logsIngestion.endpoint]"
                                    }
                                ]
                            },
                            "runAfter": {
                                "Initialize_'day'_variable": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable"
                        },
                        "Initialize_'dcrPrefix'_variable": {
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "dcrPrefix",
                                        "type": "string",
                                        "value": "[parameters('solutionName')]"
                                    }
                                ]
                            },
                            "runAfter": {
                                "Initialize_'dceUri'_variable": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable"
                        },
                        "Initialize_'month'_variable": {
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "month",
                                        "type": "string",
                                        "value": "@{formatDateTime(addDays(utcNow(), -1), 'MM')}"
                                    }
                                ]
                            },
                            "runAfter": {
                                "Initialize_'year'_variable": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable"
                        },
                        "Initialize_'storageAccountName'_variable": {
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "storageAccountName",
                                        "type": "string",
                                        "value": "[parameters('storageAccountName')]"
                                    }
                                ]
                            },
                            "runAfter": {},
                            "type": "InitializeVariable"
                        },
                        "Initialize_'tenantId'_variable": {
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "tenantId",
                                        "type": "string",
                                        "value": "[tenant().tenantId]"
                                    }
                                ]
                            },
                            "runAfter": {
                                "Initialize_'storageAccountName'_variable": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable"
                        },
                        "Initialize_'year'_variable": {
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "year",
                                        "type": "string",
                                        "value": "@{formatDateTime(addDays(utcNow(), -1), 'yyyy')}"
                                    }
                                ]
                            },
                            "runAfter": {
                                "Initialize_'tenantId'_variable": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable"
                        },
                        "Lists_blobs_in_the_root_folder": {
                            "inputs": {
                                "host": {
                                    "connection": {
                                        "name": "@parameters('$connections')['azureblob']['connectionId']"
                                    }
                                },
                                "method": "get",
                                "path": "/v2/datasets/@{encodeURIComponent(encodeURIComponent(variables('storageAccountName')))}/foldersV2",
                                "queries": {
                                    "nextPageMarker": "",
                                    "useFlatListing": false
                                }
                            },
                            "runAfter": {
                                "Parse_dataCollectionRules": [
                                    "Succeeded"
                                ]
                            },
                            "type": "ApiConnection"
                        },
                        "Parse_dataCollectionRules": {
                            "inputs": {
                                "content": "@variables('dataCollectionRules')",
                                "schema": {
                                    "properties": {
                                        "content": {
                                            "items": {
                                                "properties": {
                                                    "dcrImmutableId": {
                                                        "type": "string"
                                                    },
                                                    "dcrName": {
                                                        "type": "string"
                                                    }
                                                },
                                                "type": "object"
                                            }
                                        }
                                    }
                                }
                            },
                            "runAfter": {
                                "Initialize_'dataCollectionRules'_variable": [
                                    "Succeeded"
                                ]
                            },
                            "type": "ParseJson"
                        }
                    },
                    "contentVersion": "1.0.0.0",
                    "outputs": {},
                    "parameters": {
                        "$connections": {
                            "defaultValue": {},
                            "type": "Object"
                        }
                    },
                    "triggers": {
                        "Daily_at_01:00_UTC+1": {
                            "evaluatedRecurrence": {
                                "frequency": "Day",
                                "interval": 1,
                                "startTime": "2022-03-21T01:00:00Z",
                                "timeZone": "W. Europe Standard Time"
                            },
                            "recurrence": {
                                "frequency": "Day",
                                "interval": 1,
                                "startTime": "2022-03-21T01:00:00Z",
                                "timeZone": "W. Europe Standard Time"
                            },
                            "type": "Recurrence"
                        }
                    }
                },
                "parameters": {
                    "$connections": {
                        "value": {
                            "azureblob": {
                                "connectionId": "[resourceId('Microsoft.Web/connections', variables('logicAppConnectionName'))]",
                                "connectionName": "azureblob",
                                "connectionProperties": {
                                    "authentication": {
                                        "type": "ManagedServiceIdentity"
                                    }
                                },
                                "id": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', resourceGroup().location, '/managedApis/azureblob')]"
                            }
                        }
                    }
                }
            }
        },
        {
            "type": "Microsoft.Authorization/roleAssignments",
            "apiVersion": "2020-10-01-preview",
            "name": "[guid(concat(variables('logicAppName'), '/', string(copyIndex())))]",
            "dependsOn": [
                "[resourceId('Microsoft.Logic/workflows', variables('logicAppName'))]"
            ],
            "copy": {
                "name": "rbacCopy",
                "count": "[length(variables('roleDefinitions'))]"
            },
            "properties": {
                "principalType": "ServicePrincipal",
                "roleDefinitionId": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Authorization/roleDefinitions/', variables('roleDefinitions')[copyIndex()])]",
                "principalId": "[reference(resourceId('Microsoft.Logic/workflows', variables('logicAppName')), '2016-10-01', 'full').identity.principalId]"
            }
        }
    ],
    "outputs": {
        "tenantId": {
            "type": "string",
            "value": "[tenant().tenantId]"
        },
        "dataCollectionEndpointId": {
            "type": "string",
            "value": "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dataCollectionEndpointName'))]"
        },
        "immutableIds": {
            "type": "string",
            "value": "[concat( '{ \"content\": [ { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'alertevidence', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'alertevidence')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'alertinfo', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'alertinfo')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'cloudappevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'cloudappevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'deviceevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'deviceevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'devicefilecertificateinfo', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'devicefilecertificateinfo')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'devicefileevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'devicefileevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'deviceimageloadevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'deviceimageloadevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'deviceinfo', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'deviceinfo')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'devicelogonevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'devicelogonevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'devicenetworkevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'devicenetworkevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'devicenetworkinfo', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'devicenetworkinfo')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'deviceprocessevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'deviceprocessevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'deviceregistryevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'deviceregistryevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'emailattachmentinfo', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'emailattachmentinfo')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'emailevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'emailevents')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'emailurlinfo', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'emailurlinfo')), '2021-04-01', 'full').properties.immutableId, '\" }, { \"dcrName\": \"', variables('dataCollectionRulePrefix'), 'identitylogonevents', '\", \"dcrImmutableId\": \"', reference(resourceId('Microsoft.Insights/dataCollectionRules', concat(variables('dataCollectionRulePrefix'), 'identitylogonevents')), '2021-04-01', 'full').properties.immutableId, '\" } ] }')]"
        }
    }
}